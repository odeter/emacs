from flask import current_app as app
from angle.models import ServicenowModel, SensorModel
import pandas as pd
import numpy as np
import servicenow_api
import os
import requests

class NoServicenowCred(Exception):
    "Raised when the no servicenow credentiel is found"
    pass

def servicenow_update(servicenow_client, data):
    return None

def servicenow_insert(servicenow_client, data):
    return None

def servicenow_delete(servicenow_client, data):
    return None

def get_serviceclient(firm_id):
    service_key = ServicenowModel.find_by_firm(firm_id)
    if service_key:
        service_client = servicenow_api.Api(url=service_key.instance_name, username=service_key.username, password=service_key.password)
        return service_client
    else:
        raise NoServicenowCred

def testServiceNow(instance, user, pw):
    try:
        service_client = servicenow_api.Api(url=instance, username=user, password=pw)
    except UnauthorizedError as e:
        return {'message': 'Api does not have the right permissions - '+e}, 403
    except AuthError as e:
        return {'message': 'Api credentials could not be verified - '+e}, 401

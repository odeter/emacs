from flask import current_app as app
import os
import requests

def formatXML(api, text, recipients):
    xml = """
    <request>
        <authentication apikey="{api}" />
        <data>
            <message>
                <sendername>Derant</sendername>
                <text>{text}</text>
                <recipients>
    """.format(api=api, text=text)
    for i in recipients:
        xml += "<msisdn>{0}</msisdn>".format(i)
    xml += """
        </recipients>
            </message>
        </data>
    </request>
    """
    return xml

def send_sms(text, recipients):
    api = os.getenv('INMOBILE_API')

    if app.config['SMS_ACTIVE']:
        xml = formatXML(api, text, recipients)
        url = "https://mm.inmobile.dk/Api/V2/SendMessages"
        headers = {'Content-Type':'text/xml'}

        r = requests.post(url=url, data=xml, headers=headers)
from flask_jwt_extended import get_jwt_identity
from angle.models import db, UserModel
from flask_restful import Resource
from angle import role_required

class GetCurrentLang(Resource):
    @jwt_required
    def get(self):
        userID = get_jwt_identity()
        current_user = UserModel.find_by_id(userID)

        if current_user:
            if current_user.lang: # Check if current user has lang set, otherwise set to 'en' and return
                return {'message': 'Got language', 'lang': current_user.lang}, 200
            else:
                current_user.lang = 'en'
                try:
                    current_user.save_to_db()
                    return {'message': 'Set lang to en', 'lang': current_user.lang}, 200
                except:
                    return {'message': 'Something went wrong'}, 500
        else:
            return {'message': 'User not properly set'}, 403
